<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt Master | ë©”ì¸</title>
    <style>
        :root { --kakao-color: #FEE500; --google-color: #4285F4; }
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background-color: #f4f7f6; }
        .container { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; }
        .btn { display: block; padding: 12px; margin: 10px 0; border-radius: 8px; text-decoration: none; font-weight: bold; transition: 0.3s; }
        .btn-google { background: var(--google-color); color: white; }
        .btn-kakao { background: var(--kakao-color); color: #3c1e1e; }
        .btn-upload { background: #333; color: white; border: none; cursor: pointer; width: 100%; }
        .hidden { display: none; }
        #token-box { background: #eee; padding: 10px; font-size: 0.7rem; word-break: break-all; border-radius: 5px; margin-top: 15px; color: #666; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ§¾ Receipt Master</h1>

    <div id="before-login">
        <p>ì†Œì…œ ê³„ì •ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì‹œì‘í•˜ì„¸ìš”</p>
        <a href="/oauth2/authorization/google" class="btn btn-google">Google ë¡œê·¸ì¸</a>
        <a href="/oauth2/authorization/kakao" class="btn btn-kakao">Kakao ë¡œê·¸ì¸</a>
    </div>

    <div id="after-login" class="hidden">
        <p>ğŸ‰ <strong>ê¸°ì›ë‹˜</strong>, ë¡œê·¸ì¸ì„ í™˜ì˜í•©ë‹ˆë‹¤!</p>
        <button onclick="location.href='/upload.html'" class="btn btn-upload">ğŸ“¸ ì˜ìˆ˜ì¦ ì—…ë¡œë“œí•˜ëŸ¬ ê°€ê¸°</button>
        <div id="token-box"></div>
        <a href="/" onclick="localStorage.clear()" style="display:block; margin-top:15px; color:#999; font-size:0.8rem;">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (token) {
        localStorage.setItem('accessToken', token);
        document.getElementById('before-login').classList.add('hidden');
        document.getElementById('after-login').classList.remove('hidden');
        document.getElementById('token-box').innerText = "ë‚´ í† í°: " + token;

        // ì£¼ì†Œì°½ì—ì„œ ?token=... ë¶€ë¶„ì„ ì‹¹ ì§€ì›Œì„œ ê¹”ë”í•˜ê²Œ ë§Œë“¦
        window.history.replaceState({}, document.title, "/");
    } else if (localStorage.getItem('accessToken')) {
        // ì´ë¯¸ ë¡œê·¸ì¸ ì •ë³´ê°€ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ìˆëŠ” ê²½ìš°
        document.getElementById('before-login').classList.add('hidden');
        document.getElementById('after-login').classList.remove('hidden');
        document.getElementById('token-box').innerText = "ê¸°ì¡´ í† í° ìœ ì§€ ì¤‘";
    }
</script>
</body>
</html>